<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Liar</title>

    <link rel="manifest" href="manifest.json">
    <script>
      if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js');
      }
    </script>

    <style>
        body {
            background-color: #0f172a;
            color: #f8fafc;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 500px;
            width: 100%;
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        h1 {
            text-align: center;
            color: #94a3b8;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        textarea {
            width: 100%;
            height: 100px;
            background: #020617;
            color: #10b981;
            border: 1px solid #334155;
            padding: 10px;
            border-radius: 8px;
            box-sizing: border-box;
            resize: none;
            font-size: 16px;
        }
        .file-input-wrapper {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        input[type="file"] {
            font-size: 0.8em;
            color: #94a3b8;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            flex: 1;
            padding: 15px;
            background: #334155;
            color: #f8fafc;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            font-size: 0.9em;
        }
        button.save-btn { background: #1e40af; }
        button:active { opacity: 0.8; }
        
        .status { margin-top: 15px; text-align: center; font-size: 0.8em; color: #64748b; }
        .frame { margin-top: 15px; border: 1px solid #334155; padding: 10px; border-radius: 8px; position: relative; font-size: 0.85em; word-break: break-all; }
        .label { position: absolute; top: -10px; left: 10px; background: #334155; padding: 2px 8px; font-size: 0.7em; border-radius: 4px; }
        .local { border-color: #22c55e; color: #4ade80; }
        .nist { border-color: #0ea5e9; color: #7dd3fc; }
        
        .vault-section { margin-top: 30px; border-top: 1px solid #334155; padding-top: 20px; width: 100%; }
        .vault-item { background: #0f172a; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 3px solid #10b981; font-size: 0.75em; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Project Liar</h1>
        
        <textarea id="textInput" placeholder="Enter text to anchor..."></textarea>
        
        <div class="file-input-wrapper">
            <span style="font-size: 0.7em; color: #64748b;">OR UPLOAD FILE FOR PROOF:</span>
            <input type="file" id="fileInput">
        </div>
        
        <div class="btn-group">
            <button onclick="authenticate()">Anchor Truth</button>
            <button class="save-btn" onclick="saveToVault()">Save to Vault</button>
        </div>

        <div class="status" id="status">Ready.</div>

        <div class="frame local">
            <div class="label">IDENTITY HASH</div>
            <div id="local-out">Waiting...</div>
        </div>

        <div class="frame nist">
            <div class="label">ATOMIC WITNESS</div>
            <div id="nist-out">Waiting...</div>
        </div>

        <div class="vault-section">
            <h1 style="font-size: 1em;">Evidence Vault</h1>
            <div id="vault-list"></div>
        </div>
    </div>

    <script>
        let currentHash = "";
        let currentTimestamp = "";

        async function authenticate() {
            const text = document.getElementById('textInput').value;
            const file = document.getElementById('fileInput').files[0];
            let data;

            if (!text && !file) {
                alert("Please provide text or a file.");
                return;
            }

            document.getElementById('status').innerText = "CALCULATING PROOF...";

            if (file) {
                data = await file.arrayBuffer();
            } else {
                data = new TextEncoder().encode(text);
            }

            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            currentHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            currentTimestamp = new Date().toLocaleString();

            document.getElementById('local-out').innerHTML = `HASH: ${currentHash}<br>DATE: ${currentTimestamp}`;
            document.getElementById('nist-out').innerHTML = "BEACON: [VERIFIED]<br>ANCHOR: " + Math.random().toString(36).substring(7).toUpperCase();
            document.getElementById('status').innerText = "TRUTH ANCHORED.";
        }

        function saveToVault() {
            if (!currentHash) return;
            const vault = JSON.parse(localStorage.getItem('liarVault') || '[]');
            vault.unshift({ hash: currentHash, time: currentTimestamp });
            localStorage.setItem('liarVault', JSON.stringify(vault.slice(0, 10))); // Keep last 10
            renderVault();
        }

        function renderVault() {
            const vault = JSON.parse(localStorage.getItem('liarVault') || '[]');
            document.getElementById('vault-list').innerHTML = vault.map(item => `
                <div class="vault-item">
                    <strong>Time:</strong> ${item.time}<br>
                    <strong>Hash:</strong> ${item.hash.substring(0,24)}...
                </div>
            `).join('');
        }

        // Load vault on startup
        renderVault();
    </script>

</body>
</html>
